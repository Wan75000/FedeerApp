<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Feeder Dashboard</title>
    <style>
        body {
            background-color: #ffffff;
            color: #000;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        h2 {
            font-size: 24px;
            color: #000;
        }

        .container {
            padding: 20px;
        }

        input, button {
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
        }

        input[type="text"], input[type="password"], input[type="time"] {
            width: 80%;
            max-width: 250px;
        }

        button {
            cursor: pointer;
        }

        #screen1 {
            display: block;
        }

        #screen2 {
            display: none;
        }

        /* Style for screen 1 (WiFi setup) */
        #screen1 {
            background-color: #f4f4f4;
            padding: 40px;
            border-radius: 10px;
            width: 300px;
            margin: 0 auto;
        }

        /* Style for screen 2 (Feeder control) */
        #screen2 {
            background-color: #f4f4f4;
            padding: 20px;
            width: 80%;
            max-width: 400px;
            margin: 0 auto;
            border-radius: 10px;
        }

        .blue-btn {
            background-color: #003366;
            color: white;
        }

        .red-btn {
            background-color: red;
            color: black;
        }

        .time-picker-container {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .time-picker-container input {
            width: 60px;
        }

        .lcd {
            background-color: #000;
            color: #0f0;
            padding: 15px;
            margin: 10px 0;
            font-size: 18px;
            border-radius: 5px;
            width: 90%;
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <!-- Screen 1: Wi-Fi Setup -->
    <div id="screen1">
        <h2>Masukkan WiFi</h2>
        <input type="text" id="ssid" placeholder="SSID WiFi">
        <input type="password" id="password" placeholder="Password WiFi">
        <button class="blue-btn" onclick="connectWiFi()">Konek</button>
    </div>

    <!-- Screen 2: Feeder Control -->
    <div id="screen2">
        <h2>Fish Feeder</h2>

        <!-- LCD Virtual OLED -->
        <div class="lcd" id="status">Status: Offline</div>

        <!-- Control Servo -->
        <button class="blue-btn" onclick="servoManual()">Manual</button>
        <button class="blue-btn" onclick="servoAuto()">Otomatis</button>

        <!-- Time Picker for Schedule -->
        <div class="time-picker-container">
            <input type="time" id="timePicker1">
            <input type="time" id="timePicker2">
            <input type="time" id="timePicker3">
        </div>

        <button class="blue-btn" onclick="setSchedule()">Atur Jadwal</button>
        
        <!-- Exit Button -->
        <button class="red-btn" onclick="exitApp()">Keluar</button>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBakbDeDpJlG4YVHdqdXGrvQRlLOkmb78I",
            authDomain: "fedeerapp-6d328.firebaseapp.com",
            databaseURL: "https://fedeerapp-6d328-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "fedeerapp-6d328",
            storageBucket: "fedeerapp-6d328.firebasestorage.app",
            messagingSenderId: "222072627019",
            appId: "1:222072627019:web:abb48675675f86af6052ce"
        };

        const app = initializeApp(firebaseConfig);

        // Update the LCD display
        function updateLCD(status, servoMode, schedule) {
            const statusElement = document.getElementById('status');
            
            let statusMessage = `Status: ${status}`;
            if (servoMode) {
                statusMessage += `<br>Servo: ${servoMode}`;
            }
            if (schedule.length > 0) {
                statusMessage += `<br>Jadwal Pakan: ${schedule.join(', ')}`;
            }
            statusElement.innerHTML = statusMessage;
        }

        // Function to connect to WiFi
        function connectWiFi() {
            let ssid = document.getElementById('ssid').value;
            let password = document.getElementById('password').value;

            // Save WiFi credentials to Firebase
            fetch('https://fedeerapp-6d328-default-rtdb.asia-southeast1.firebasedatabase.app/wifi.json', {
                method: 'PUT',
                body: JSON.stringify({ ssid, password }),
                headers: { 'Content-Type': 'application/json' }
            }).then(() => {
                // Update LCD and show status on screen 2
                updateLCD('Connected', 'N/A', []);
                document.getElementById('screen1').style.display = 'none';
                document.getElementById('screen2').style.display = 'block';
            });
        }

        // Function to control servo manually
        function servoManual() {
            fetch('https://fedeerapp-6d328-default-rtdb.asia-southeast1.firebasedatabase.app/servo.json', {
                method: 'PUT',
                body: JSON.stringify({ mode: "manual", status: "on" }),
                headers: { 'Content-Type': 'application/json' }
            }).then(() => {
                updateLCD('Connected', 'Manual', []);
            });
        }

        // Function to control servo automatically
        function servoAuto() {
            fetch('https://fedeerapp-6d328-default-rtdb.asia-southeast1.firebasedatabase.app/servo.json', {
                method: 'PUT',
                body: JSON.stringify({ mode: "auto" }),
                headers: { 'Content-Type': 'application/json' }
            }).then(() => {
                updateLCD('Connected', 'Automatic', []);
            });
        }

        // Function to set feeding schedule
        function setSchedule() {
            let time1 = document.getElementById('timePicker1').value;
            let time2 = document.getElementById('timePicker2').value;
            let time3 = document.getElementById('timePicker3').value;
            let schedule = [time1, time2, time3];

            fetch('https://fedeerapp-6d328-default-rtdb.asia-southeast1.firebasedatabase.app/schedule.json', {
                method: 'PUT',
                body: JSON.stringify(schedule),
                headers: { 'Content-Type': 'application/json' }
            }).then(() => {
                updateLCD('Connected', 'N/A', schedule);
                alert("Jadwal pakan berhasil diatur!");
            }).catch((error) => {
                console.error("Error:", error);
                alert("Terjadi kesalahan saat mengatur jadwal.");
            });
        }

        // Function to exit the app
        function exitApp() {
            window.location.reload();
        }

        // Initialize LCD display on page load
        window.onload = () => {
            updateLCD('Offline', 'N/A', []);
        };
    </script>
</body>
</html>