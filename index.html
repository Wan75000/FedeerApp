<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Feeder Dashboard</title>
    <style>
        body { background-color: navy; color: white; text-align: center; font-family: Arial; }
        input, button { margin: 5px; padding: 10px; }
        #screen2 { display: none; }
    </style>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBakbDeDpJlG4YVHdqdXGrvQRlLOkmb78I",
            authDomain: "fedeerapp-6d328.firebaseapp.com",
            databaseURL: "https://fedeerapp-6d328-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "fedeerapp-6d328",
            storageBucket: "fedeerapp-6d328.firebasestorage.app",
            messagingSenderId: "222072627019",
            appId: "1:222072627019:web:abb48675675f86af6052ce"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
    </script>
</head>
<body>
    <div id="screen1">
        <h2>Masukkan WiFi</h2>
        <input type="text" id="ssid" placeholder="SSID WiFi">
        <input type="password" id="password" placeholder="Password WiFi">
        <button onclick="connectWiFi()">Konek</button>
    </div>

    <div id="screen2">
        <h2>Fish Feeder</h2>
        <div id="status">Status: Offline</div>
        <button onclick="servoManual()">Manual</button>
        <button onclick="servoAuto()">Otomatis</button>
        <input type="time" id="timePicker">
        <button onclick="setSchedule()">Atur Jadwal</button>
        <button onclick="exitApp()">Keluar</button>
    </div>

    <script>
        // Function for Wi-Fi connection
        function connectWiFi() {
            let ssid = document.getElementById('ssid').value;
            let password = document.getElementById('password').value;
            set(ref(db, 'wifi/'), {
                ssid: ssid,
                password: password
            }).then(() => {
                document.getElementById('screen1').style.display = 'none';
                document.getElementById('screen2').style.display = 'block';
            }).catch(error => {
                console.error("Error saving WiFi credentials:", error);
            });
        }

        // Function to control the servo manually
        function servoManual() {
            set(ref(db, 'servo/'), {
                mode: "manual",
                status: "on"
            }).then(() => {
                console.log("Servo in manual mode");
            }).catch(error => {
                console.error("Error controlling servo:", error);
            });
        }

        // Function to control the servo automatically
        function servoAuto() {
            set(ref(db, 'servo/'), {
                mode: "auto"
            }).then(() => {
                console.log("Servo in auto mode");
            }).catch(error => {
                console.error("Error controlling servo:", error);
            });
        }

        // Function to set the feeding schedule
        function setSchedule() {
            let time = document.getElementById('timePicker').value;
            set(ref(db, 'schedule/'), {
                feedingTimes: [time]
            }).then(() => {
                console.log("Feeding schedule set to:", time);
            }).catch(error => {
                console.error("Error setting feeding schedule:", error);
            });
        }

        // Function to exit the app
        function exitApp() {
            window.location.reload();
        }
    </script>
</body>
</html>
